<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game of the Generals – Two Phones Arbiter</title>

<!-- Firebase loaded ONCE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: Arial;
  margin: 0;
  padding: 20px;
  background: #f2f2f2;
}
.container {
  max-width: 500px;
  margin: auto;
  background: white;
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 0 15px rgba(0,0,0,0.2);
}
h1 { text-align:center; margin-bottom:20px; font-size:24px; }
label { font-weight:bold; display:block; margin-top:15px; }
select, input { width:100%; padding:12px; font-size:16px; border-radius:8px; margin-top:6px; }
button { width:100%; padding:14px; font-size:18px; margin-top:12px; border:none; border-radius:10px; cursor:pointer; }
button.submit { background:#007bff; color:#fff; }
button.submit:active { background:#0056b3; }
button.reset { background:#dc3545; color:#fff; }
button.reset:active { background:#c82333; }
#output { margin-top:25px; font-size:22px; font-weight:bold; text-align:center; }
.note { text-align:center; font-size:13px; color:#666; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
<h1>Game of the Generals – Two Phones</h1>

<label>Select Your Player:</label>
<select id="playerSelect">
  <option value="">Select Player</option>
  <option value="player1">Player 1</option>
  <option value="player2">Player 2</option>
</select>

<label>Your Piece:</label>
<select id="myPiece">
  <option value="">Select Piece...</option>
  <option value="general5">5 Star General</option>
  <option value="general4">4 Star General</option>
  <option value="general3">3 Star General</option>
  <option value="general2">2 Star General</option>
  <option value="general1">1 Star General</option>
  <option value="colonel">Colonel</option>
  <option value="lt_colonel">Lt. Colonel</option>
  <option value="major">Major</option>
  <option value="captain">Captain</option>
  <option value="1lt">1st Lieutenant</option>
  <option value="2lt">2nd Lieutenant</option>
  <option value="sergeant">Sergeant</option>
  <option value="spy">Spy</option>
  <option value="private">Private</option>
  <option value="flag">Flag</option>
</select>

<button class="submit" onclick="submitPiece()">Submit</button>
<button class="reset" onclick="resetGame()">RESET</button>

<div id="output"></div>
<div class="note">Each player submits their piece secretly. Arbiter reveals the result when both players submit.</div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCbO877EE_W28vCjbSDeMjHX4aa_fRdNT8",
  authDomain: "generals-arbiter.firebaseapp.com",
  databaseURL: "https://generals-arbiter-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "generals-arbiter",
  storageBucket: "generals-arbiter.firebasestorage.app",
  messagingSenderId: "500778773054",
  appId: "1:500778773054:web:ea69714e45d9382e7abf6f"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const strength = {
  general5:15, general4:14, general3:13, general2:12, general1:11,
  colonel:10, lt_colonel:9, major:8, captain:7, "1lt":6, "2lt":5,
  sergeant:4, private:1, spy:16, flag:0
};

let player = null;
let mySelection = null;

// Submit
function submitPiece() {
  player = document.getElementById("playerSelect").value;
  mySelection = document.getElementById("myPiece").value;

  if(!player) return alert("Select your player!");
  if(!mySelection) return alert("Select your piece!");

  // Set the player's piece
  db.ref("game/" + player).set({ piece: mySelection });

  document.getElementById("myPiece").innerHTML = `<option>— HIDDEN —</option>`;
  document.getElementById("output").textContent = "Waiting for opponent...";

  // Check if both players have submitted
  db.ref("game").once("value", snapshot => {
    const data = snapshot.val();
    const A = data?.player1?.piece;
    const B = data?.player2?.piece;

    if(A && B) {
      const result = resolveBattle(A, B);

      // Store the result in DB
      db.ref("game/result").set(result);
    }
  });
}

// Listen for the result
db.ref("game/result").on("value", snapshot => {
  const result = snapshot.val();
  if(result) {
    document.getElementById("output").textContent = result;
  }
});


// Battle rules
function resolveBattle(A, B) {
  if(A === "flag" && B === "flag") return "Both Flags die – GAME OVER";
  if(A === "flag") return "Player 2 captured the Flag – GAME OVER";
  if(B === "flag") return "Player 1 captured the Flag – GAME OVER";

  if(A === "spy" && B === "spy") return "Both die";
  if(A === "spy") return (B === "private") ? "Player 2 wins" : "Player 1 wins";
  if(B === "spy") return (A === "private") ? "Player 1 wins" : "Player 2 wins";

  if(A === "sergeant" && (B === "private" || B === "flag")) return "Player 1 wins";
  if(B === "sergeant" && (A === "private" || A === "flag")) return "Player 2 wins";

  if(strength[A] === strength[B]) return "Both die";
  return (strength[A] > strength[B]) ? "Player 1 wins" : "Player 2 wins";
}

// Reset without reload
function resetGame() {
  db.ref("game").remove();
  document.getElementById("output").textContent = "";
  document.getElementById("playerSelect").value = "";
  document.getElementById("myPiece").innerHTML = `
    <option value="">Select Piece...</option>
    <option value="general5">5 Star General</option>
    <option value="general4">4 Star General</option>
    <option value="general3">3 Star General</option>
    <option value="general2">2 Star General</option>
    <option value="general1">1 Star General</option>
    <option value="colonel">Colonel</option>
    <option value="lt_colonel">Lt. Colonel</option>
    <option value="major">Major</option>
    <option value="captain">Captain</option>
    <option value="1lt">1st Lieutenant</option>
    <option value="2lt">2nd Lieutenant</option>
    <option value="sergeant">Sergeant</option>
    <option value="spy">Spy</option>
    <option value="private">Private</option>
    <option value="flag">Flag</option>
  `;
}
</script>


</body>
</html>




