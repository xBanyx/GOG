<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game of the Generals – Two Phones Arbiter</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial; background:#f2f2f2; padding:20px; }
.container {
  max-width:500px; margin:auto; background:white; padding:25px;
  border-radius:14px; box-shadow:0 0 15px rgba(0,0,0,0.2);
}
h1 { text-align:center; }
label { margin-top:15px; font-weight:bold; display:block; }
select, button {
  width:100%; padding:12px; font-size:16px; margin-top:6px;
  border-radius:8px;
}
button.submit { background:#007bff; color:white; }
button.reset { background:#dc3545; color:white; margin-top:12px; }
#output { font-size:22px; text-align:center; margin-top:20px; }
</style>
</head>
<body>

<div class="container">
<h1>Game of the Generals – Two Phones</h1>

<label>Select Your Player:</label>
<select id="playerSelect">
  <option value="">Select Player</option>
  <option value="player1">Player 1</option>
  <option value="player2">Player 2</option>
</select>

<label>Your Piece:</label>
<select id="myPiece">
  <option value="">Select Piece...</option>
  <option value="general5">5 Star General</option>
  <option value="general4">4 Star General</option>
  <option value="general3">3 Star General</option>
  <option value="general2">2 Star General</option>
  <option value="general1">1 Star General</option>
  <option value="colonel">Colonel</option>
  <option value="lt_colonel">Lt. Colonel</option>
  <option value="major">Major</option>
  <option value="captain">Captain</option>
  <option value="1lt">1st Lieutenant</option>
  <option value="2lt">2nd Lieutenant</option>
  <option value="sergeant">Sergeant</option>
  <option value="spy">Spy</option>
  <option value="private">Private</option>
  <option value="flag">Flag</option>
</select>

<button class="submit" onclick="submitPiece()">Submit</button>
<button class="reset" onclick="resetGame()">RESET</button>

<div id="output"></div>
</div>

<script>
// Correct Firebase URL
const firebaseConfig = {
  apiKey: "AIzaSyCbO877EE_W28vCjbSDeMjHX4aa_fRdNT8",
  authDomain: "generals-arbiter.firebaseapp.com",
  databaseURL: "https://generals-arbiter-default-rtdb.firebaseio.com",
  projectId: "generals-arbiter",
  storageBucket: "generals-arbiter.firebasestorage.app",
  messagingSenderId: "500778773054",
  appId: "1:500778773054:web:ea69714e45d9382e7abf6f"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// strength table
const strength = {
  general5:15, general4:14, general3:13, general2:12, general1:11,
  colonel:10, lt_colonel:9, major:8, captain:7, "1lt":6, "2lt":5,
  sergeant:4, private:1, spy:16, flag:0
};

function submitPiece() {
  const player = document.getElementById("playerSelect").value;
  const piece = document.getElementById("myPiece").value;

  if(!player) return alert("Select your player!");
  if(!piece) return alert("Select piece!");

  db.ref("game/" + player).set({ piece });

  // hide from screen
  document.getElementById("myPiece").innerHTML = `<option>— HIDDEN —</option>`;
  document.getElementById("output").textContent = "Waiting for opponent...";
}

// Listen for updates (shows to BOTH phones)
db.ref("game").on("value", snap => {
  const g = snap.val();
  if(!g || !g.player1 || !g.player2) return;

  const A = g.player1.piece;
  const B = g.player2.piece;
  if(!A || !B) return;

  document.getElementById("output").textContent = resolveBattle(A,B);
});

// Battle logic
function resolveBattle(A,B) {
  if(A==="flag" && B==="flag") return "Both Flags die – DRAW";
  if(A==="flag") return "Player 2 captured the Flag!";
  if(B==="flag") return "Player 1 captured the Flag!";

  if(A==="spy" && B==="spy") return "Both Spies Die";

  if(A==="spy") return (B==="private") ? "Player 2 Wins" : "Player 1 Wins";
  if(B==="spy") return (A==="private") ? "Player 1 Wins" : "Player 2 Wins";

  if(A==="sergeant" && (B==="private"||B==="flag")) return "Player 1 Wins";
  if(B==="sergeant" && (A==="private"||A==="flag")) return "Player 2 Wins";

  if(strength[A] === strength[B]) return "Both Pieces Die";
  return (strength[A] > strength[B]) ? "Player 1 Wins" : "Player 2 Wins";
}

function resetGame() {
  db.ref("game").remove();
  location.reload();
}
</script>

</body>
</html>
